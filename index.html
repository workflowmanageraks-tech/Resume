<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bookmark Manager</title>
<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f9;
    padding:20px;
    transition:0.3s;
}
body.dark{
    background:#121212;
    color:#eee;
}
.container{
    max-width:720px;
    margin:auto;
    background:#fff;
    padding:20px;
    border-radius:10px;
}
body.dark .container{
    background:#1e1e1e;
}
input, select{
    width:100%;
    padding:8px;
    margin:6px 0;
}
button{
    padding:6px 10px;
    margin:3px 3px 3px 0;
    cursor:pointer;
}
.bookmark, .label-item{
    background:#eef;
    padding:10px;
    margin-top:10px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    border-left:5px solid #667eea;
}
body.dark .bookmark, body.dark .label-item{
    background:#2a2a2a;
}
a{font-weight:bold;}
hr{margin:15px 0;}
.small{font-size:12px;color:#666;}
</style>
</head>
<body>

<div class="container">
<h2>Bookmark Manager</h2>
<button onclick="toggleDark()">Dark Mode</button>

<!-- FILTER -->
<select id="filter" onchange="render()"></select>

<hr>

<!-- ADD BOOKMARK -->
<input id="name" placeholder="Name">
<input id="url" placeholder="Website URL">
<select id="label"></select>
<button onclick="saveBookmark()">Add / Update Bookmark</button>

<hr>

<!-- MANAGE LABELS -->
<h3>Labels</h3>
<input id="newLabel" placeholder="Add new label">
<button onclick="addLabel()">Add Label</button>
<div id="labelList"></div>

<hr>
<button onclick="exportTxt()">Export</button>
<input type="file" accept=".txt" onchange="importTxt(event)">

<div id="list"></div>
</div>

<script>
let bookmarks = JSON.parse(localStorage.getItem("bookmarks")) || [];
let labels = JSON.parse(localStorage.getItem("labels")) || ["Everyone","Alone"];
let editIndex = -1;
let editLabelIndex = -1;

/* INIT */
function init(){
    updateLabelDropdowns();
    render();
    renderLabels();
}
init();

/* Dark Mode */
function toggleDark(){
    document.body.classList.toggle("dark");
}

/* Update Label dropdowns */
function updateLabelDropdowns(){
    const labelSelect = document.getElementById("label");
    const filterSelect = document.getElementById("filter");

    labelSelect.innerHTML="";
    filterSelect.innerHTML="<option value='All'>Show All</option>";

    labels.forEach(l=>{
        labelSelect.innerHTML += `<option value="${l}">${l}</option>`;
        filterSelect.innerHTML += `<option value="${l}">${l}</option>`;
    });

    localStorage.setItem("labels", JSON.stringify(labels));
}

/* Render Labels list with edit/delete */
function renderLabels(){
    const list = document.getElementById("labelList");
    list.innerHTML="";
    labels.forEach((l,i)=>{
        const div = document.createElement("div");
        div.className="label-item";
        div.innerHTML = `
            <span>${l}</span>
            <div>
                <button onclick="editLabel(${i})">Edit</button>
                <button onclick="deleteLabel(${i})">Delete</button>
            </div>
        `;
        list.appendChild(div);
    });
}

/* Add/Edit Label */
function addLabel(){
    const input = document.getElementById("newLabel");
    const newLabel = input.value.trim();
    if(!newLabel) return alert("Enter label name");
    if(labels.includes(newLabel) && editLabelIndex === -1) return alert("Label already exists");

    if(editLabelIndex === -1){
        labels.push(newLabel);
    } else {
        const oldLabel = labels[editLabelIndex];
        labels[editLabelIndex] = newLabel;
        // Update bookmarks with old label name
        bookmarks.forEach(b=>{
            if(b.label === oldLabel) b.label = newLabel;
        });
        editLabelIndex = -1;
    }
    input.value="";
    updateLabelDropdowns();
    renderLabels();
    render();
}

/* Edit Label */
function editLabel(i){
    document.getElementById("newLabel").value = labels[i];
    editLabelIndex = i;
}

/* Delete Label */
function deleteLabel(i){
    const labelToDelete = labels[i];
    if(confirm(`Delete label "${labelToDelete}"? All bookmarks with this label will be moved to "Everyone".`)){
        labels.splice(i,1);
        bookmarks.forEach(b=>{
            if(b.label === labelToDelete) b.label = "Everyone";
        });
        updateLabelDropdowns();
        renderLabels();
        render();
    }
}

/* Save Bookmark */
function saveBookmark(){
    const name = document.getElementById("name").value.trim();
    const url = document.getElementById("url").value.trim();
    const label = document.getElementById("label").value;

    if(!name || !url){
        alert("Name & URL required");
        return;
    }

    const data = {name, url, label};
    if(editIndex === -1){
        bookmarks.push(data);
    } else {
        bookmarks[editIndex] = data;
        editIndex = -1;
    }
    localStorage.setItem("bookmarks", JSON.stringify(bookmarks));
    clearInputs();
    render();
}

/* Clear inputs */
function clearInputs(){
    document.getElementById("name").value="";
    document.getElementById("url").value="";
    document.getElementById("label").selectedIndex=0;
}

/* Render Bookmarks */
function render(){
    const list = document.getElementById("list");
    const filter = document.getElementById("filter").value;
    list.innerHTML="";

    bookmarks.forEach((b,i)=>{
        if(filter !== "All" && b.label !== filter) return;
        const div = document.createElement("div");
        div.className="bookmark";
        div.innerHTML=`
            <div>
                <a href="${b.url}" target="_blank">${b.name}</a><br>
                <span class="small">Label: ${b.label}</span>
            </div>
            <div>
                <button onclick="editBookmark(${i})">Edit</button>
                <button onclick="deleteBookmark(${i})">Delete</button>
            </div>
        `;
        list.appendChild(div);
    });
}

/* Edit Bookmark */
function editBookmark(i){
    document.getElementById("name").value = bookmarks[i].name;
    document.getElementById("url").value = bookmarks[i].url;
    document.getElementById("label").value = bookmarks[i].label;
    editIndex = i;
}

/* Delete Bookmark */
function deleteBookmark(i){
    if(confirm("Delete bookmark?")){
        bookmarks.splice(i,1);
        localStorage.setItem("bookmarks", JSON.stringify(bookmarks));
        render();
    }
}

/* Export Bookmarks */
function exportTxt(){
    if(bookmarks.length===0) return alert("No data");
    const text = bookmarks.map(b=>`${b.name}|${b.url}|${b.label}`).join("\n");
    const blob = new Blob([text],{type:"text/plain"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download="bookmarks.txt";
    a.click();
}

/* Import Bookmarks */
function importTxt(e){
    const file = e.target.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = ()=>{
        reader.result.split("\n").forEach(line=>{
            const [name,url,label] = line.split("|");
            if(name && url){
                if(label && !labels.includes(label)) labels.push(label);
                bookmarks.push({
                    name:name.trim(),
                    url:url.trim(),
                    label:label?.trim() || "Everyone"
                });
            }
        });
        localStorage.setItem("bookmarks", JSON.stringify(bookmarks));
        updateLabelDropdowns();
        renderLabels();
        render();
    };
    reader.readAsText(file);
}
</script>
</body>
</html>
