<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AKS Server</title>
<style>
:root{
--bg:#f4f6ff;
--card:#ffffff;
--text:#333;
--accent:#667eea;
}
.dark{
--bg:#121212;
--card:#1f1f1f;
--text:#f1f1f1;
--accent:#9aa8ff;
}
*{box-sizing:border-box;font-family:Segoe UI}
body{
margin:0;
min-height:100vh;
background:var(--bg);
display:flex;
justify-content:center;
align-items:center;
padding:20px;
color:var(--text)
}
.app{
width:100%;
max-width:900px;
background:var(--card);
border-radius:16px;
padding:25px;
box-shadow:0 20px 40px rgba(0,0,0,.25)
}
h1{text-align:center}
textarea,input,select,button{
width:100%;
padding:12px;
border-radius:10px;
margin-top:10px;
font-size:14px
}
button{border:none;cursor:pointer}
.add-btn{background:var(--accent);color:#fff}
.export-btn{background:#2ecc71;color:#fff}
.dark-btn{background:#000;color:#fff;margin-bottom:10px}
.notes{margin-top:20px}
.note{
background:var(--bg);
border-left:6px solid var(--accent);
padding:15px;
border-radius:10px;
margin-bottom:15px
}
.completed{text-decoration:line-through;opacity:.6}
.priority-high{border-left-color:#e74c3c}
.priority-medium{border-left-color:#f1c40f}
.priority-low{border-left-color:#2ecc71}
.note-actions button{
width:auto;
padding:6px 10px;
font-size:12px;
margin-right:5px
}
</style>
</head>
<body>

<div class="app">
<h1>AKS Server</h1>

<button class="dark-btn" onclick="toggleDark()">Dark Mode</button>

<textarea id="noteInput" placeholder="Write task..."></textarea>
<input type="datetime-local" id="reminderTime">

<select id="repeatType">
<option value="none">One Time</option>
<option value="daily">Daily</option>
<option value="weekly">Weekly</option>
</select>

<select id="priority">
<option value="high">High Priority</option>
<option value="medium">Medium Priority</option>
<option value="low">Low Priority</option>
</select>

<button class="add-btn" onclick="addTask()">Add Task</button>
<button class="export-btn" onclick="exportTasks()">Export TXT</button>

<input id="search" placeholder="Search task..." oninput="render()">

<div class="notes" id="list"></div>
</div>

<audio id="alarm">
<source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg">
</audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

/* ---------------- FIREBASE CONFIG ---------------- */
const firebaseConfig = {
  apiKey: "AIzaSyDgJUc5BGEl2ABhs1FfHnjWQ3-9X8EG7Y4",
  authDomain: "aks-server-fd7cf.firebaseapp.com",
  projectId: "aks-server-fd7cf",
  storageBucket: "aks-server-fd7cf.firebasestorage.app",
  messagingSenderId: "2505156516",
  appId: "1:2505156516:web:d8ec59327481c9dc8c0331",
  measurementId: "G-BCL25V0MNY"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
signInAnonymously(auth);

/* ---------------- APP LOGIC ---------------- */
let tasks = JSON.parse(localStorage.getItem("aks_tasks")) || [];
let uid = null;

/* ---------------- REAL-TIME FIRESTORE SYNC ---------------- */
onAuthStateChanged(auth, user => {
  if(user){
    uid = user.uid;
    const userDoc = doc(db, "users", uid);

    // Listen for real-time updates
    onSnapshot(userDoc, snap => {
      if(snap.exists()){
        tasks = snap.data().tasks || [];
        localStorage.setItem("aks_tasks", JSON.stringify(tasks));
        render();
      }
    });
  }
});

/* ---------------- HELPER FUNCTIONS ---------------- */
function save(){
  localStorage.setItem("aks_tasks", JSON.stringify(tasks));
  if(uid){
    setDoc(doc(db,"users",uid),{tasks});
  }
}

window.toggleDark = () => {
  document.body.classList.toggle("dark");
};

window.addTask = () => {
  if(!noteInput.value.trim()) return;
  tasks.unshift({
    text: noteInput.value,
    reminder: reminderTime.value || null,
    repeat: repeatType.value,
    priority: priority.value,
    done: false
  });
  noteInput.value = "";
  save();
  render();
};

window.toggleDone = i => {
  tasks[i].done = !tasks[i].done;
  save();
  render();
};

window.snooze = i => {
  tasks[i].reminder = new Date(Date.now() + 300000).toISOString();
  save();
  alert("Snoozed 5 minutes");
};

window.removeTask = i => {
  tasks.splice(i,1);
  save();
  render();
};

function render(){
  list.innerHTML = "";
  const q = search.value.toLowerCase();
  tasks.filter(t => t.text.toLowerCase().includes(q)).forEach((t,i) => {
    list.innerHTML += `
    <div class="note priority-${t.priority} ${t.done?'completed':''}">
      <input type="checkbox" ${t.done?'checked':''} onclick="toggleDone(${i})">
      ${t.text}
      <small>${t.reminder?new Date(t.reminder).toLocaleString():""}</small>
      <div class="note-actions">
        <button onclick="snooze(${i})">Snooze</button>
        <button onclick="removeTask(${i})">Delete</button>
      </div>
    </div>`;
  });
}

window.exportTasks = () => {
  let t = "AKS SERVER TASKS\n\n";
  tasks.forEach((x,i) => {
    t += ${i+1}. ${x.text} [${x.priority}] ${x.done?"âœ“":""}\n;
  });
  const b = new Blob([t],{type:"text/plain"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(b);
  a.download = "aks_tasks.txt";
  a.click();
};

render();
</script>

</body>
</html>
