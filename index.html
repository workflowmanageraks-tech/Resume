<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bookmark Manager</title>
<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f9;
    padding:20px;
}
body.dark{ background:#121212;color:#eee; }
.container{
    max-width:720px;
    margin:auto;
    background:#fff;
    padding:20px;
    border-radius:10px;
}
body.dark .container{ background:#1e1e1e; }
input,select{ width:100%;padding:8px;margin:6px 0; }
button{ padding:6px 10px;margin:4px;cursor:pointer; }
.bookmark,.label-item{
    background:#eef;
    padding:10px;
    margin-top:10px;
    display:flex;
    justify-content:space-between;
    border-left:5px solid #667eea;
}
body.dark .bookmark,
body.dark .label-item{ background:#2a2a2a; }
a{ font-weight:bold; cursor:pointer; }
.small{ font-size:12px;color:#666; }
hr{margin:15px 0;}
</style>
</head>
<body>

<div class="container">
<h2>Bookmark Manager</h2>
<button onclick="toggleDark()">Dark Mode</button>

<select id="filter" onchange="render()"></select>

<hr>

<input id="name" placeholder="Name">
<input id="url" placeholder="Website URL">
<select id="label"></select>
<button onclick="saveBookmark()">Add / Update Bookmark</button>

<hr>

<h3>Labels</h3>
<input id="newLabel" placeholder="Add / Edit label">
<button onclick="addLabel()">Save Label</button>
<div id="labelList"></div>

<hr>

<!-- EXPORT OPTIONS -->
<button onclick="exportDownload()">Export Text (Download)</button>
<button onclick="exportCopy()">Export Text (Copy)</button>
<button onclick="sendWhatsApp()">Send to WhatsApp</button>
<input type="file" accept=".txt" onchange="importTxt(event)">

<div id="list"></div>
</div>

<script>
let bookmarks = JSON.parse(localStorage.getItem("bookmarks")) || [];
let labels = JSON.parse(localStorage.getItem("labels")) || ["Everyone"];
let editIndex = -1, editLabelIndex = -1;

init();

function init(){
    updateLabelDropdowns();
    renderLabels();
    render();
}

function toggleDark(){
    document.body.classList.toggle("dark");
}

function updateLabelDropdowns(){
    const labelSel=document.getElementById("label");
    const filterSel=document.getElementById("filter");
    labelSel.innerHTML="";
    filterSel.innerHTML="<option value='All'>Show All</option>";
    labels.forEach(l=>{
        labelSel.innerHTML+=`<option value="${l}">${l}</option>`;
        filterSel.innerHTML+=`<option value="${l}">${l}</option>`;
    });
    localStorage.setItem("labels",JSON.stringify(labels));
}

function renderLabels(){
    const box=document.getElementById("labelList");
    box.innerHTML="";
    labels.forEach((l,i)=>{
        box.innerHTML+=`
        <div class="label-item">
            <span>${l}</span>
            <div>
                <button onclick="editLabel(${i})">Edit</button>
                <button onclick="deleteLabel(${i})">Delete</button>
            </div>
        </div>`;
    });
}

function addLabel(){
    const input=document.getElementById("newLabel");
    const val=input.value.trim();
    if(!val) return;
    if(editLabelIndex===-1){
        if(labels.includes(val)) return alert("Label exists");
        labels.push(val);
    }else{
        const old=labels[editLabelIndex];
        labels[editLabelIndex]=val;
        bookmarks.forEach(b=>{ if(b.label===old) b.label=val; });
        editLabelIndex=-1;
    }
    input.value="";
    updateLabelDropdowns();
    renderLabels();
    render();
}

function editLabel(i){
    document.getElementById("newLabel").value=labels[i];
    editLabelIndex=i;
}

function deleteLabel(i){
    const l=labels[i];
    if(confirm("Delete label?")){
        labels.splice(i,1);
        bookmarks.forEach(b=>{ if(b.label===l) b.label="Everyone"; });
        updateLabelDropdowns();
        renderLabels();
        render();
    }
}

function saveBookmark(){
    const nameInput=document.getElementById("name");
    const urlInput=document.getElementById("url");
    const labelInput=document.getElementById("label");

    const n=nameInput.value.trim();
    const u=urlInput.value.trim();
    const l=labelInput.value;

    if(!n||!u) return alert("Name & URL required");

    const data={name:n,url:u,label:l};

    if(editIndex===-1) bookmarks.push(data);
    else{ bookmarks[editIndex]=data; editIndex=-1; }

    localStorage.setItem("bookmarks",JSON.stringify(bookmarks));

    nameInput.value=""; urlInput.value="";
    labelInput.selectedIndex=0;

    render();
}

function render(){
    const list=document.getElementById("list");
    const f=document.getElementById("filter").value;
    list.innerHTML="";
    bookmarks.forEach((b,i)=>{
        if(f!=="All" && b.label!==f) return;
        list.innerHTML+=`
        <div class="bookmark">
            <div>
                <a href="${b.url}" target="_blank">${b.name}</a><br>
                <span class="small">${b.label}</span>
            </div>
            <div>
                <button onclick="editBookmark(${i})">Edit</button>
                <button onclick="deleteBookmark(${i})">Delete</button>
            </div>
        </div>`;
    });
}

function editBookmark(i){
    document.getElementById("name").value=bookmarks[i].name;
    document.getElementById("url").value=bookmarks[i].url;
    document.getElementById("label").value=bookmarks[i].label;
    editIndex=i;
}

function deleteBookmark(i){
    if(confirm("Delete?")){
        bookmarks.splice(i,1);
        localStorage.setItem("bookmarks",JSON.stringify(bookmarks));
        render();
    }
}

/* EXPORT – DOWNLOAD */
function exportDownload(){
    if(!bookmarks.length) return alert("No data");
    const text=bookmarks.map(b=>`${b.name}|${b.url}|${b.label}`).join("\n");
    const blob=new Blob([text],{type:"text/plain"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="bookmarks.txt";
    a.click();
}

/* EXPORT – COPY */
function exportCopy(){
    if(!bookmarks.length) return alert("No data");
    const text=bookmarks.map(b=>`${b.name}|${b.url}|${b.label}`).join("\n");
    navigator.clipboard.writeText(text);
    alert("Copied to clipboard");
}

/* WHATSAPP – ANDROID INTENT (TEXT) */
function sendWhatsApp(){
    if(!bookmarks.length) return alert("No data");
    const text=bookmarks.map(b=>`${b.name}\n${b.url}`).join("\n\n");
    const intentUrl="intent://send?text="+encodeURIComponent(text)
        +"#Intent;scheme=whatsapp;package=com.whatsapp;end";
    window.location.href=intentUrl;
}

/* IMPORT TXT */
function importTxt(e){
    const file=e.target.files[0];
    if(!file) return;
    const reader=new FileReader();
    reader.onload=()=>{
        reader.result.split("\n").forEach(l=>{
            const [n,u,lb]=l.split("|");
            if(n&&u){
                if(lb && !labels.includes(lb)) labels.push(lb);
                bookmarks.push({name:n.trim(),url:u.trim(),label:lb||"Everyone"});
            }
        });
        localStorage.setItem("bookmarks",JSON.stringify(bookmarks));
        updateLabelDropdowns(); renderLabels(); render();
    };
    reader.readAsText(file);
}
</script>

</body>
</html>